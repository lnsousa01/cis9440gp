{{ config(materialized='table') }}
WITH violations AS(
SELECT * FROM `cis9440gp.RawDataset.RestaurantInspection`),
violation_facts_table AS(
    SELECT DISTINCT grade_dim_id, violation_dim_id, location_dim_id, business_dim_id, date_dim_id
    FROM violations
    RIGHT JOIN `cis9440gp.dbt_qlin.date_dimension` ON
        `cis9440gp.dbt_qlin.date_dimension`.date=DATE(violations.inspection_date)
    RIGHT JOIN `cis9440gp.dbt_lsousa.grade_dim`
            ON CASE 
                WHEN violations.grade = 'A' THEN 'A'
                WHEN violations.grade = 'B' THEN 'B'
                WHEN violations.grade = 'C' THEN 'C'
                WHEN violations.grade IN ('Z', 'P') THEN 'Grade Pending'
                WHEN violations.grade = 'N' THEN 'Not Yet Graded'
                ELSE 'N/A'
            END = `cis9440gp.dbt_lsousa.grade_dim`.grade
    RIGHT JOIN `cis9440gp.dbt_lsousa.violation_dim`
            ON CASE
                WHEN violations.violation_code = '09E' AND violations.violation_description = 'Wash hands sign not posted near or above hand washing sink.' THEN '09E'
                WHEN violations.violation_code = '09C' AND violations.violation_description = 'Food contact surface not properly maintained.' THEN '09C'
                WHEN violations.violation_code = '28-04' AND violations.violation_description = 'Equipment used for ROP not approved by the Department' THEN '28-04'
                WHEN violations.violation_code = '15-27' AND violations.violation_description = 'Sign prohibiting smoking or using electronic cigarettes not conspicuously posted.' THEN '15-27'
                WHEN violations.violation_code = '10G' AND violations.violation_description = 'Dishwashing and ware washing:  Cleaning and sanitizing of tableware, including dishes, utensils, and equipment deficient.' THEN '10G'
                WHEN violations.violation_code = '02B' AND violations.violation_description = 'Hot TCS food item not held at or above 140 °F.' THEN '02B'
                WHEN violations.violation_code = '04A' AND violations.violation_description = 'Food Protection Certificate (FPC) not held by manager or supervisor of food operations.' THEN '04A'
                WHEN violations.violation_code = '10J' AND violations.violation_description = 'Hand wash sign not posted' THEN '10J'
                WHEN violations.violation_code = '10C' AND violations.violation_description = 'Lighting Inadequate' THEN '10C'
                WHEN violations.violation_code = '04L' AND violations.violation_description = 'Evidence of mice or live mice in establishment' 's food or non-food areas.' THEN '04L'
                WHEN violations.violation_code = '04M' AND violations.violation_description = 'Live roaches in facility' 's food or non-food area.' THEN '04M'
                WHEN violations.violation_code = '04A' AND violations.violation_description = 'Food Protection Certificate not held by supervisor of food operations.' THEN '04A'
                WHEN violations.violation_code = '02B' AND violations.violation_description = 'Hot TCS food item not held at or above 140 °F.' THEN '02B'
                WHEN violations.violation_code = '10F' AND violations.violation_description = 'Non-food contact surface or equipment made of unacceptable material, not kept clean, or not properly sealed, raised, spaced or movable to allow accessibility for cleaning on all sides, above and underneath the unit.' THEN '10F'
                WHEN violations.violation_code = '08A' AND violations.violation_description = 'Establishment is not free of harborage or conditions conducive to rodents, insects or other pests.' THEN '08A'
                WHEN violations.violation_code = '09B' AND violations.violation_description = 'Thawing procedure improper.' THEN '09B'
                WHEN violations.violation_code = '09C' AND violations.violation_description = 'Design, construction, materials used or maintenance of food contact surface improper.  Surface not easily cleanable, sanitized and maintained.' THEN '09C'
                WHEN violations.violation_code = '02G' AND violations.violation_description = 'Cold food item held above 41º F (smoked fish and reduced oxygen packaged foods above 38 ºF) except during necessary preparation.' THEN '02G'
                WHEN violations.violation_code = '05H' AND violations.violation_description = 'No approved written standard operating procedure for avoiding contamination by refillable returnable containers.' THEN '05H'
                WHEN violations.violation_code = '06E' AND violations.violation_description = 'Sanitized equipment or utensil, including in-use food dispensing utensil, improperly used or stored.' THEN '06E'
                WHEN violations.violation_code = '04K' AND violations.violation_description = 'Evidence of rats or live rats in establishment' 's food or non-food areas.' THEN '04K'
                WHEN violations.violation_code = '06D' AND violations.violation_description = 'Food contact surface not properly washed, rinsed and sanitized after each use and following any activity when contamination may have occurred.' THEN '06D'
                WHEN violations.violation_code = '04H' AND violations.violation_description = 'Raw, cooked or prepared food is adulterated, contaminated, cross-contaminated, or not discarded in accordance with HACCP plan.' THEN '04H'
                WHEN violations.violation_code = '10E' AND violations.violation_description = 'Accurate thermometer not provided in refrigerated or hot holding equipment.' THEN '10E'
                WHEN violations.violation_code = '06C' AND violations.violation_description = 'Food, supplies, or equipment not protected from potential source of contamination during storage, preparation, transportation, display, service or from customer' 's refillable, reusable container.  Condiments not in single-service containers or dispensed directly by the vendor.' THEN '06C'
                WHEN violations.violation_code = '22A' AND violations.violation_description = 'Nuisance created or allowed to exist.  Facility not free from unsafe, hazardous, offensive or annoying conditions.' THEN '22A'
                WHEN violations.violation_code = '04L' AND violations.violation_description = 'Evidence of mice or live mice present in facility' 's food and/or non-food areas.' THEN '04L'
                WHEN violations.violation_code = '28-05' AND violations.violation_description = 'Food adulterated or misbranded.  Adulterated or misbranded food possessed, being manufactured, produced, packed, sold, offered for sale, delivered or given away' THEN '28-05'
                WHEN violations.violation_code = '10H' AND violations.violation_description = 'Single service article not provided. Single service article reused or not protected from contamination when transported, stored, dispensed. Drinking straws not completely enclosed in wrapper or dispensed from a sanitary device.' THEN '10H'
                WHEN violations.violation_code = '06A' AND violations.violation_description = 'Personal cleanliness is inadequate. Outer garment soiled with possible contaminant. Effective hair restraint not worn where required. Jewelry worn on hands or arms. Fingernail polish worn or fingernails not kept clean and trimmed.' THEN '06A'
                WHEN violations.violation_code = '04N' AND violations.violation_description = 'Filth flies or food/refuse/sewage associated with (FRSA) flies or other nuisance pests in establishment' 's food and/or non-food areas. FRSA flies include house flies, blow flies, bottle flies, flesh flies, drain flies, Phorid flies and fruit flies.' THEN '04N'
                WHEN violations.violation_code = '10D' AND violations.violation_description = 'Mechanical or natural ventilation not provided, inadequate, improperly installed, in disrepair or fails to prevent and control excessive build-up of grease, heat, steam condensation, vapors, odors, smoke or fumes.' THEN '10D'
                WHEN violations.violation_code = '20D' AND violations.violation_description = '“Choking first aid” poster not posted. “Alcohol and pregnancy” warning sign not posted. Resuscitation equipment: exhaled air resuscitation masks (adult & pediatric), latex gloves, sign not posted.' THEN '20D'
                WHEN violations.violation_code = '02H' AND violations.violation_description = 'Food not cooled by an approved method whereby the internal product temperature is reduced from 140º F to 70º F or less within 2  hours, and from 70º F to 41º F or less within 4 additional hours.' THEN '02H'
                WHEN violations.violation_code = '04N' AND violations.violation_description = 'Filth flies or food/refuse/sewage-associated (FRSA) flies present in facility' 's food and/or non-food areas.  Filth flies include house flies, little house flies, blow flies, bottle flies and flesh flies.  Food/refuse/sewage-associated flies include fruit flies, drain flies and Phorid flies.' THEN '04N'
                WHEN violations.violation_code = '10F' AND violations.violation_description = 'Non-food contact surface improperly constructed. Unacceptable material used. Non-food contact surface or equipment improperly maintained and/or not properly sealed, raised, spaced or movable to allow accessibility for cleaning on all sides, above and underneath the unit.' THEN '10F'
                WHEN violations.violation_code = '06A' AND violations.violation_description = 'Personal cleanliness is inadequate. Outer garment soiled with possible contaminant. Effective hair restraint not worn where required.  Jewelry is worn on hands or arms.  Fingernail polish worn or fingernails not kept clean and trimmed.' THEN '06A'
                WHEN violations.violation_code = '04K' AND violations.violation_description = 'Evidence of rats or live rats present in facility' 's food and/or non-food areas.' THEN '04K'
                WHEN violations.violation_code = '04E' AND violations.violation_description = 'Toxic chemical improperly labeled, stored or used such that food contamination may occur.' THEN '04E'
                WHEN violations.violation_code = '04N' AND violations.violation_description = 'Filth flies or food/refuse/sewage associated with (FRSA) flies or other nuisance pests  in  establishment' 's food and/or non-food areas. FRSA flies include house flies, blow flies, bottle flies, flesh flies, drain flies, Phorid flies and fruit flies.' THEN '04N'
                WHEN violations.violation_code = '02C' AND violations.violation_description = 'Hot TCS food item that has been cooked and  cooled is being held for service without first being reheated to 165º F or above within 2 hours.' THEN '02C'
                WHEN violations.violation_code = '06C' AND violations.violation_description = 'Food, supplies, and equipment not protected from potential source of contamination during storage, preparation, transportation, display or service.' THEN '06C'
                WHEN violations.violation_code = '06C' AND violations.violation_description = 'Food, supplies, or equipment not protected from potential source of contamination during storage, preparation, transportation, display, service or from customer' 's refillable, reusable container. Condiments not in single-service containers or dispensed directly by the vendor.' THEN '06C'
                WHEN violations.violation_code = '05D' AND violations.violation_description = 'No hand washing facility in or adjacent to toilet room or within 25 feet of a food preparation, food service or ware washing area. Hand washing facility not accessible, obstructed or used for non-hand washing purposes. No hot and cold running water or water at inadequate pressure. No soap or acceptable hand-drying device.' THEN '05D'
                WHEN violations.violation_code = '06C' AND violations.violation_description = 'Food not protected from potential source of contamination during storage, preparation, transportation, display or service.' THEN '06C'
                WHEN violations.violation_code = '08A' AND violations.violation_description = 'Facility not vermin proof. Harborage or conditions conducive to attracting vermin to the premises and/or allowing vermin to exist.' THEN '08A'
                WHEN violations.violation_code = '10E' AND violations.violation_description = 'Accurate thermometer not provided or properly located in refrigerated, cold storage or hot holding equipment' THEN '10E'
                WHEN violations.violation_code = '10B' AND violations.violation_description = 'Anti-siphonage or back-flow prevention device not provided where required; equipment or floor not properly drained; sewage disposal system in disrepair or not functioning properly. Condensation or liquid waste improperly disposed of.' THEN '10B'
                WHEN violations.violation_code = '02H' AND violations.violation_description = 'After cooking or removal from hot holding, TCS food not cooled by an approved method whereby the internal temperature is reduced from 140 °F to 70 °F or less within 2  hours, and from 70 °F to 41 °F or less within 4 additional hours.' THEN '02H'
                WHEN violations.violation_code = '10B' AND violations.violation_description = 'Plumbing not properly installed or maintained; anti-siphonage or backflow prevention device not provided where required; equipment or floor not properly drained; sewage disposal system in disrepair or not functioning properly.' THEN '10B'
                WHEN violations.violation_code = '10H' AND violations.violation_description = 'Proper sanitization not provided for utensil ware washing operation.' THEN '10H'
                WHEN violations.violation_code = '02G' AND violations.violation_description = 'Cold TCS food item held above 41 °F; smoked or processed fish held above 38 °F; intact raw eggs held above 45 °F; or reduced oxygen packaged (ROP) TCS foods held above required temperatures except during active necessary preparation.' THEN '02G'
                WHEN violations.violation_code = '05H' AND violations.violation_description = 'No facilities available to wash, rinse and sanitize utensils and/or equipment.' THEN '05H'
                WHEN violations.violation_code = '10G' AND violations.violation_description = 'Dishwashing and ware washing: Cleaning and sanitizing of tableware, including dishes, utensils, and equipment deficient.' THEN '10G'
                WHEN violations.violation_code = '10I' AND violations.violation_description = 'Single service item reused, improperly stored, dispensed; not used when required.' THEN '10I'
                WHEN violations.violation_code = '28-06' AND violations.violation_description = 'Contract with a pest management professional not in place. Record of extermination activities not kept on premises.' THEN '28-06'
                WHEN violations.violation_code = '22F' AND violations.violation_description = 'MISBRANDED AND LABELING' THEN '22F'
                WHEN violations.violation_code = '19-07' AND violations.violation_description = 'Failure to maintain a sufficient supply of single-use, non-compostable plastic straws.' THEN '19-07'
                WHEN violations.violation_code = '20F' AND violations.violation_description = 'Current letter grade sign not posted.' THEN '20F'
                WHEN violations.violation_code = '04J' AND violations.violation_description = 'Properly scaled and calibrated thermometer or thermocouple not provided or not readily accessible in food preparation and hot/cold holding areas to measure temperatures of TCS foods during cooking, cooling, reheating, and holding.' THEN '04J'
                WHEN violations.violation_code = '05D' AND violations.violation_description = 'Hand washing facility not provided in or near food preparation area and toilet room. Hot and cold running water at adequate pressure to enable cleanliness of employees not provided at facility. Soap and an acceptable hand-drying device not provided.' THEN '05D'
                WHEN violations.violation_code = '06B' AND violations.violation_description = 'Tobacco or electronic cigarette use, eating, or drinking from open container in food preparation, food storage or dishwashing area.' THEN '06B'
                WHEN violations.violation_code = '02H' AND violations.violation_description = 'After cooking or removal from hot holding, TCS food not cooled by an approved method whereby the internal temperature is reduced from 140 °F to 70 °F or less within 2 hours, and from 70 °F to 41 °F or less within 4 additional hours.' THEN '02H'
                WHEN violations.violation_code = '06F' AND violations.violation_description = 'Wiping cloths not stored clean and dry, or in a sanitizing solution, between uses.' THEN '06F'
                WHEN violations.violation_code = '06B' AND violations.violation_description = 'Tobacco use, eating, or drinking from open container in food preparation, food storage or dishwashing area observed.' THEN '06B'
                WHEN violations.violation_code = '10A' AND violations.violation_description = 'Toilet facility not maintained or provided with toilet paper, waste receptacle or self-closing door.' THEN '10A'
                WHEN violations.violation_code = '04C' AND violations.violation_description = 'Food worker/food vendor does not use utensil or other barrier to eliminate bare hand contact with food that will not receive adequate additional heat treatment.' THEN '04C'
                WHEN violations.violation_code = '20-04' AND violations.violation_description = '“Choking first aid” poster not posted. “Alcohol and pregnancy” warning sign not posted. Resuscitation equipment: exhaled air resuscitation masks (adult & pediatric), latex gloves, sign not posted.' THEN '20-04'
                WHEN violations.violation_code = '09C' AND violations.violation_description = 'Design, construction, materials used or maintenance of food contact surface improper. Surface not easily cleanable, sanitized and maintained.' THEN '09C'
                WHEN violations.violation_code = '19-06' AND violations.violation_description = 'Providing single-use, non-compostable plastic straws to customers without customer request (including providing such straws at a self-serve station)' THEN '19-06'
                WHEN violations.violation_code = '06A' AND violations.violation_description = 'Personal cleanliness inadequate. Outer garment soiled with possible contaminant. Effective hair restraint not worn in an area where food is prepared.' THEN '06A'
                WHEN violations.violation_code = '22C' AND violations.violation_description = 'Bulb not shielded or shatterproof, in areas where there is extreme heat, temperature changes, or where accidental contact may occur.' THEN '22C'
                WHEN violations.violation_code = '20-08' AND violations.violation_description = 'Failure to post or conspicuously post healthy eating information' THEN '20-08'
                WHEN violations.violation_code = '08C' AND violations.violation_description = 'Pesticide not properly labeled or used by unlicensed individual.  Pesticide, other toxic chemical improperly used/stored. Unprotected, unlocked bait station used.' THEN '08C'
                WHEN violations.violation_code = '04M' AND violations.violation_description = 'Live roaches present in facility' 's food and/or non-food areas.' THEN '04M'
                WHEN violations.violation_code = '08C' AND violations.violation_description = 'Pesticide not properly labeled or used by unlicensed individual. Pesticide, other toxic chemical improperly used/stored. Unprotected, unlocked bait station used.' THEN '08C'
                WHEN violations.violation_code = '03I' AND violations.violation_description = 'Juice packaged on premises with no or incomplete label, no warning statement' THEN '03I'
                WHEN violations.violation_code = '05A' AND violations.violation_description = 'Sewage disposal system is not provided, improper, inadequate or unapproved.' THEN '05A'
                WHEN violations.violation_code = '05D' AND violations.violation_description = 'No hand washing facility in or adjacent to toilet room or within 25 feet of a food preparation, food service or ware washing area.  Hand washing facility not accessible, obstructed or used for non-hand washing purposes. No hot and cold running water or water at inadequate pressure. No soap or acceptable hand-drying device.' THEN '05D'
                WHEN violations.violation_code = '08C' AND violations.violation_description = 'Pesticide use not in accordance with label or applicable laws. Prohibited chemical used/stored. Open bait station used.' THEN '08C'
                WHEN violations.violation_code = '05A' AND violations.violation_description = 'Sewage disposal system improper or unapproved.' THEN '05A'
                WHEN violations.violation_code = '16-03' AND violations.violation_description = 'Caloric content not posted on menus, menu boards or food tags, in a food service establishment that is 1 of 15 or more outlets operating the same type of business nationally under common ownership or control, or as a franchise or doing business under the same name, for each menu item that is served in portions, the size and content of which are standardized.' THEN '16-03'
                WHEN violations.violation_code = '16-06' AND violations.violation_description = 'Additional nutritional information statement not posted, or additional nutritional information not provided' THEN '16-06'
                WHEN violations.violation_code = '04J' AND violations.violation_description = 'Appropriately scaled metal stem-type thermometer or thermocouple not provided or used to evaluate temperatures of potentially hazardous foods during cooking, cooling, reheating and holding.' THEN '04J'
                WHEN violations.violation_code = '08B' AND violations.violation_description = 'Garbage receptacle not pest or water resistant, with tight-fitting lids, and covered except while in active use. Garbage receptacle and cover not cleaned after emptying and prior to reuse. Garbage, refuse and other solid and liquid waste not collected, stored, removed and disposed of so as to prevent a nuisance.' THEN '08B'
                WHEN violations.violation_code = '06A' AND violations.violation_description = 'Personal cleanliness is inadequate. Outer garment soiled with possible contaminant. Effective hair restraint not worn where required.  Jewelry worn on hands or arms.  Fingernail polish worn or fingernails not kept clean and trimmed.' THEN '06A'
                WHEN violations.violation_code = '04O' AND violations.violation_description = 'Live animal other than fish in tank or service animal present in facility' 's food or non-food area.' THEN '04O'
                WHEN violations.violation_code = '05F' AND violations.violation_description = 'Insufficient or no hot holding, cold storage or cold holding equipment provided to maintain Time/Temperature Control for Safety Foods (TCS) at required temperatures' THEN '05F'
                WHEN violations.violation_code = '20-06' AND violations.violation_description = 'Current letter grade or Grade Pending card not posted' THEN '20-06'
                WHEN violations.violation_code = '20-04' AND violations.violation_description = '"Choking first aid" poster not posted. "Alcohol and Pregnancy" warning sign not posted. Resuscitation equipment: exhaled air resuscitation masks (adult & pediatric), latex gloves, sign not posted.' THEN '20-04'
                WHEN violations.violation_code = '20-01' AND violations.violation_description = 'Food allergy information poster not conspicuously posted where food is being prepared or processed by food workers.' THEN '20-01'
                WHEN violations.violation_code = '04F' AND violations.violation_description = 'Food, food preparation area, food storage area, area used by employees or patrons, contaminated by sewage or liquid waste.' THEN '04F'
                WHEN violations.violation_code = '03A' AND violations.violation_description = 'Food, prohibited, from unapproved or unknown source, home canned or home prepared.  Animal slaughtered, butchered or dressed (eviscerated, skinned) in establishment. Reduced Oxygen Packaged (ROP) fish not frozen before processing.  ROP food prepared on premises transported to another site.' THEN '03A'
                WHEN violations.violation_code = '03C' AND violations.violation_description = 'Unclean or cracked whole eggs or unpasteurized liquid, frozen or powdered eggs kept or used.' THEN '03C'
                WHEN violations.violation_code = '06G' AND violations.violation_description = 'HACCP plan not approved or approved HACCP plan not maintained on premises.' THEN '06G'
                WHEN violations.violation_code = '09A' AND violations.violation_description = 'Swollen, leaking, rusted or otherwise damaged canned food to be returned to distributor not segregated from intact product and clearly labeled DO NOT USE' THEN '09A'
                WHEN violations.violation_code = '15F6' AND violations.violation_description = 'Workplace SFAA policy not prominently posted in workplace' THEN '15F6'
                WHEN violations.violation_code = '10C' AND violations.violation_description = 'Lighting inadequate; permanent lighting not provided in food preparation areas, ware washing areas, and storage rooms. Shatterproof bulb or shield to prevent broken glass from falling into food or onto surfaces, not installed.' THEN '10C'
                WHEN violations.violation_code = '1500' AND violations.violation_description = 'Flavored tobacco products sold or offered for sale' THEN '1500'
                WHEN violations.violation_code = '04F' AND violations.violation_description = 'Food, food preparation area, food storage area, or other area used by employees or patrons, contaminated by sewage or liquid waste.' THEN '04F'
                WHEN violations.violation_code = '10D' AND violations.violation_description = 'Mechanical or natural ventilation system not provided,  improperly installed, in disrepair and/or fails to prevent excessive build-up of grease, heat, steam condensation vapors, odors, smoke, and fumes.' THEN '10D'
                WHEN violations.violation_code = '03E' AND violations.violation_description = 'Potable water supply inadequate. Water or ice not potable or from unapproved source. Cross connection in potable water supply system observed.' THEN '03E'
                WHEN violations.violation_code = '18-11' AND violations.violation_description = 'Food Protection Certificate not available for inspection' THEN '18-11'
                WHEN violations.violation_code = '03A' AND violations.violation_description = 'Food from unapproved or unknown source or home canned. Reduced oxygen packaged (ROP) fish not frozen before processing; or ROP foods prepared on premises transported to another site.' THEN '03A'
                WHEN violations.violation_code = '06F' AND violations.violation_description = 'Wiping cloths soiled or not stored in sanitizing solution.' THEN '06F'
                WHEN violations.violation_code = '15-42' AND violations.violation_description = 'Failure to make a good faith effort to inform smokers or electronic cigarette users of Smoke-Free Air Act ("SFAA") prohibitions' THEN '15-42'
                WHEN violations.violation_code = '15-21' AND violations.violation_description = 'Flavored tobacco products sold, offered for sale' THEN '15-21'
                WHEN violations.violation_code = '19-10' AND violations.violation_description = 'Failure to display required signage about plastic straw availability.' THEN '19-10'
                WHEN violations.violation_code = '20-05' AND violations.violation_description = 'Current letter grade or "Grade Pending" card not conspicuously posted or visible to passersby' THEN '20-05'
                WHEN violations.violation_code = '04E' AND violations.violation_description = 'Toxic chemical or pesticide improperly stored or used such that food contamination may occur.' THEN '04E'
                WHEN violations.violation_code = '28-01' AND violations.violation_description = 'Nuisance created or allowed to exist. Facility not free from unsafe, hazardous, offensive or annoying condition.' THEN '28-01'
                WHEN violations.violation_code = '02A' AND violations.violation_description = 'Time/Temperature Control for Safety (TCS) food not cooked to required minimum internal temperature. • Poultry, poultry parts, ground and comminuted poultry, all stuffing containing poultry, meats, fish or ratites to or above 165 °F for 15 seconds with no interruption of the cooking process • Ground meat, and food containing ground and comminuted meat, to or above 158 °F for 15 seconds with no interruption of the cooking process, except per individual customer request • Pork, any food containing pork to or above 150 °F for 15 seconds • Mechanically tenderized or injected meats to or above 155 °F. • Whole meat roasts and beef steak to or above required temperature and time except per individual customer request • Raw animal foods cooked in microwave to or above165 °F, covered, rotated or stirred • All other foods to or above 140 °F for 15 seconds; shell eggs to or above 145 °F for 15 seconds except per individual customer request.' THEN '02A'
                WHEN violations.violation_code = '15F7' AND violations.violation_description = 'Sign prohibiting smoking or using electronic cigarettes not conspicuously  posted' THEN '15F7'
                WHEN violations.violation_code = '10H' AND violations.violation_description = 'Single service article not provided.  Single service article reused or not protected from contamination when transported, stored, dispensed.  Drinking straws not completely enclosed in wrapper or dispensed from a sanitary device.' THEN '10H'
                WHEN violations.violation_code = '09B' AND violations.violation_description = 'Thawing procedures improper.' THEN '09B'
                WHEN violations.violation_code = '20A' AND violations.violation_description = 'Food allergy information poster not conspicuously posted where food is being prepared or processed by food workers.' THEN '20A'
                WHEN violations.violation_code = '09A' AND violations.violation_description = 'Swollen, leaking, rusted or otherwise damaged canned food to be returned to distributor not segregated from intact product and clearly labeled DO NOT USE' THEN '09A'
                WHEN violations.violation_code = '28-03' AND violations.violation_description = 'Lighting fixture located over, by or within food storage, preparation, service or display facility, and facility where utensils and equipment are cleaned and stored, which may shatter due to extreme heat, temperature changes or accidental contact; not fitted with shatterproof bulb or shielded and encased, with end caps or other device.' THEN '28-03'
                WHEN violations.violation_code = '16-02' AND violations.violation_description = 'The original nutrition fact labels or ingredient label for a cooking oil, shortening or margarine or food item sold in bulk, or acceptable manufacturer' 's documentation not maintained on site.' THEN '16-02'
                WHEN violations.violation_code = '28-05' AND violations.violation_description = 'Food adulterated or misbranded. Adulterated or misbranded food possessed, being manufactured, produced, packed, sold, offered for sale, delivered or given away' THEN '28-05'
                WHEN violations.violation_code = '04D' AND violations.violation_description = 'Food worker/food vendor does not wash hands thoroughly  after using the toilet, or after coughing, sneezing, smoking, eating, preparing raw foods or otherwise contaminating hands or does not change gloves when required; Worker fails to refrain from smoking or  being fully clothed in clean outer garments.' THEN '04D'
                WHEN violations.violation_code = '28-06' AND violations.violation_description = 'Contract with a pest management professional not in place.  Record of extermination activities not kept on premises.' THEN '28-06'
                WHEN violations.violation_code = '04C' AND violations.violation_description = 'Food worker does not use proper utensil to eliminate bare hand contact with food that will not receive adequate additional heat treatment.' THEN '04C'
                WHEN violations.violation_code = '04F' AND violations.violation_description = 'Food preparation area, food storage area, or other area used by employees or patrons, contaminated by sewage or liquid waste.' THEN '04F'
                WHEN violations.violation_code = '02D' AND violations.violation_description = 'Commercially processed pre-cooked TCS in hermetically sealed containers and precooked TCS in intact packages from non-retail food processing establishments not heated to 140 ¬∞F within 2 hours of removal from container or package.' THEN '02D'
                WHEN violations.violation_code = '16-04' AND violations.violation_description = 'Required succinct nutritional statements not posted on menu(s) for adults and children (2,000 calories per day for adults)' THEN '16-04'
                WHEN violations.violation_code = '05H' AND violations.violation_description = 'Written Standard Operating Procedure (SOP) approved by the Department for refillable, reusable containers not available at the time of inspection.  Container construction improper' THEN '05H'
                WHEN violations.violation_code = '02C' AND violations.violation_description = 'Hot TCS food item that has been cooked and cooled is being held for service without first being reheated to 165¬∫ F or above within 2 hours.' THEN '02C'
                WHEN violations.violation_code = '02A' AND violations.violation_description = 'Time/Temperature Control for Safety (TCS) food not cooked to required minimum internal temperature. • Poultry, poultry parts, ground and comminuted poultry, all stuffing containing poultry, meats, fish or ratites to or above 165 °F for 15 seconds with no interruption of the cooking process • Ground meat, and food containing ground and comminuted meat, to or above 158 °F for 15 seconds with no interruption of the cooking process, except per individual customer request • Pork, any food containing pork to or above 150 °F for 15 seconds • Mechanically tenderized or injected meats to or above 155 °F. • Whole meat roasts and beef steak to or above required temperature and time except per individual customer request • Raw animal foods cooked in microwave to or above165 °F, covered, rotated or stirred • All other foods to or above 140 °F for 15 seconds; shell eggs to or above 145 °F for 15 seconds except per individual customer request.' THEN '02A'
                WHEN violations.violation_code = '05C' AND violations.violation_description = 'Food contact surface, refillable, reusable containers, or equipment improperly constructed, placed or maintained. Unacceptable material used. Culinary sink or other acceptable method not provided for washing food.' THEN '05C'
                WHEN violations.violation_code = '03A' AND violations.violation_description = 'Food, prohibited, from unapproved or unknown source, home canned or home prepared. Animal slaughtered, butchered or dressed (eviscerated, skinned) in establishment. Reduced Oxygen Packaged (ROP) fish not frozen before processing. ROP food prepared on premises transported to another site.' THEN '03A'
                WHEN violations.violation_code = '03E' AND violations.violation_description = 'No or inadequate potable water supply. Water or ice not potable or from unapproved source. Bottled water not NY State certified. Cross connection in potable water supply system.' THEN '03E'
                WHEN violations.violation_code = '05E' AND violations.violation_description = 'Toilet facility not provided for employees or for patrons when required. Shared patron-employee toilet accessed through kitchen, food prep or storage area or utensil washing area.' THEN '05E'
                WHEN violations.violation_code = '19-05' AND violations.violation_description = 'Providing single-use plastic stirrers or single-use plastic splash sticks.' THEN '19-05'
                WHEN violations.violation_code = '02F' AND violations.violation_description = 'Meat, fish, molluscan shellfish, unpasteurized raw shell eggs, poultry or other TCS offered or served raw or undercooked and written notice not provided to consumer.' THEN '02F'
                WHEN violations.violation_code = '09A' AND violations.violation_description = 'Canned food product observed dented and not segregated from other consumable food items.' THEN '09A'
                WHEN violations.violation_code = '05F' AND violations.violation_description = 'Insufficient or no refrigerated or hot holding equipment to keep potentially hazardous foods at required temperatures.' THEN '05F'
                WHEN violations.violation_code = '02I' AND violations.violation_description = 'TCS food removed from cold holding or prepared from or combined with ingredients at room temperature not cooled by an approved method to 41 ¬∞F or below within 4 hours.' THEN '02I'
                WHEN violations.violation_code = '04O' AND violations.violation_description = 'Live animals other than fish in tank or service animal present in facility' 's food and/or non-food areas.' THEN '04O'
                WHEN violations.violation_code = '04P' AND violations.violation_description = 'Food containing a prohibited substance held, kept, offered, prepared, processed, packaged, or served.' THEN '04P'
                WHEN violations.violation_code = '03B' AND violations.violation_description = 'Shellfish not from approved source, not or improperly tagged/labeled; tags not retained for 90 days.' THEN '03B'
                WHEN violations.violation_code = '02C' AND violations.violation_description = 'Hot food item that has been cooked and refrigerated is being held for service without first being reheated to 165¬∫ F or above within 2 hours.' THEN '02C'
                WHEN violations.violation_code = '18-14' AND violations.violation_description = 'Order or notice posted or required to be posted by the Department mutilated, obstructed or removed.' THEN '18-14'
                WHEN violations.violation_code = '10A' AND violations.violation_description = 'Toilet facility not maintained and provided with toilet paper, waste receptacle and self-closing door.' THEN '10A'
                WHEN violations.violation_code = '02A' AND violations.violation_description = 'Food not cooked to required minimum temperature.' THEN '02A'
                WHEN violations.violation_code = '15-01' AND violations.violation_description = 'Smoking or electronic cigarette use allowed in prohibited area' THEN '15-01'
                WHEN violations.violation_code = '15-22' AND violations.violation_description = 'Original label for smoking products sold or offered for sale.' THEN '15-22'
                WHEN violations.violation_code = '15-32' AND violations.violation_description = 'Warning sign re dangers of hookah smoking not posted at or on each public entryway to Non-Tobacco Hookah Establishment (NTHE) patron' THEN '15-32'
                WHEN violations.violation_code = '22G' AND violations.violation_description = 'Sale or use of certain expanded polystyrene items restricted' THEN '22G'
                WHEN violations.violation_code = '09D' AND violations.violation_description = 'Food service operation occurring in room or area used as living or sleeping quarters.' THEN '09D'
                WHEN violations.violation_code = '16E' AND violations.violation_description = 'Additional nutritional information statement not posted, and/or additional nutritional information not provided.' THEN '16E'
                WHEN violations.violation_code = '22E' AND violations.violation_description = 'ROP processing equipment not approved by DOHMH.' THEN '22E'
                WHEN violations.violation_code = '15-37' AND violations.violation_description = 'Workplace SFAA policy not prominently posted in workplace.' THEN '15-37'
                WHEN violations.violation_code = '08B' AND violations.violation_description = 'Covered garbage receptacle not provided or inadequate, except that garbage receptacle may be uncovered during active use. Garbage storage area not properly constructed or maintained; grinder or compactor dirty.' THEN '08B'
                WHEN violations.violation_code = '03B' AND violations.violation_description = 'Shellfish not from approved source, improperly tagged/labeled; tags not retained for 90 days.' THEN '03B'
                WHEN violations.violation_code = '05B' AND violations.violation_description = 'Harmful noxious gas or vapor detected.  Carbon Monoxide (CO) level exceeds nine (9) ppm' THEN '05B'
                WHEN violations.violation_code = '20E' AND violations.violation_description = 'Letter grade or Grade Pending card not conspicuously posted and visible to passersby.' THEN '20E'
                WHEN violations.violation_code = '05B' AND violations.violation_description = 'Harmful, noxious gas or vapor detected. CO =13 ppm.' THEN '05B'
                WHEN violations.violation_code = '04I' AND violations.violation_description = 'Unprotected food re-served.' THEN '04I'
                WHEN violations.violation_code = '19-11' AND violations.violation_description = 'Providing compostable plastic straws to be used outside of the food establishment' 's premises; failure to appropriately dispose of compostable plastic straws; failure to maintain required bins for disposal of compostable plastic straws.' THEN '19-11'
                WHEN violations.violation_code = '16-01' AND violations.violation_description = 'A food containing artificial trans-fat, with 0.5 grams or more of trans fat per serving, is being stored, distributed, held for service, used in preparation of a menu item, or served.' THEN '16-01'
                WHEN violations.violation_code = '18-01' AND violations.violation_description = 'Current valid permit, registration or other authorization to operate a Food Service Establishment (FSE) or Non-retail Food Processing Establishment (NRFP) not available.' THEN '18-01'
                WHEN violations.violation_code = '19-10' AND violations.violation_description = 'Failure to display required signage about plastic straw availability' THEN '19-10'
                WHEN violations.violation_code = '18G' AND violations.violation_description = 'Manufacture of frozen dessert not authorized on Food Service Establishment permit. Milk or milk product undated, improperly dated or expired.' THEN '18G'
                WHEN violations.violation_code = '19-01' AND violations.violation_description = 'Organics mixed with non-organic material' THEN '19-01'
                WHEN violations.violation_code = '16B' AND violations.violation_description = 'The original nutritional fact labels and/or ingredient label for a cooking oil, shortening or margarine or food item sold in bulk, or acceptable manufacturer' 's documentation not maintained on site.' THEN '16B'
                WHEN violations.violation_code = '15F1' AND violations.violation_description = 'Ashtrays in smoke-free area' THEN '15F1'
                WHEN violations.violation_code = '07A' AND violations.violation_description = 'Duties of an officer of the Department interfered with or obstructed.' THEN '07A'
                WHEN violations.violation_code = '02F' AND violations.violation_description = 'Meat, fish or molluscan shellfish served raw or undercooked without prior notification to customer.' THEN '02F'
                WHEN violations.violation_code = '18F' AND violations.violation_description = 'Permit not conspicuously displayed.' THEN '18F'
                WHEN violations.violation_code = '05C' AND violations.violation_description = 'Food contact surface improperly constructed or located. Unacceptable material used.' THEN '05C'
                WHEN violations.violation_code = '16D' AND violations.violation_description = 'Required nutritional information statement not posted (2,000 calories per day).' THEN '16D'
                WHEN violations.violation_code = '16C' AND violations.violation_description = 'Required calorie information not posted/improperly posted.' THEN '16C'
                WHEN violations.violation_code = '05B' AND violations.violation_description = 'Harmful noxious gas or vapor detected. Carbon Monoxide (CO) level exceeds nine (9) ppm' THEN '05B'
                WHEN violations.violation_code = '18C' AND violations.violation_description = 'Notice of the Department of Board of Health mutilated, obstructed, or removed.' THEN '18C'
                WHEN violations.violation_code = '16-10' AND violations.violation_description = 'Sodium Warning statement not posted conspicuously at the point of purchase. “Warning: [icon image] indicates that the sodium (salt) content of this item is higher than the total daily recommended limit (2300 mg). High sodium intake can increase blood pressure and risk of heart disease and stroke.”' THEN '16-10'
                WHEN violations.violation_code = '04D' AND violations.violation_description = 'Food worker/food vendor does not wash hands thoroughly after using the toilet, or after coughing, sneezing, smoking, eating, preparing raw foods or otherwise contaminating hands or does not change gloves when required; Worker fails to refrain from smoking or being fully clothed in clean outer garments.' THEN '04D'
                WHEN violations.violation_code = '18-08' AND violations.violation_description = 'Permit not conspicuously displayed.' THEN '18-08'
                WHEN violations.violation_code = '03E' AND violations.violation_description = 'No or inadequate potable water supply. Water or ice not potable or from unapproved source. Bottled water not NY State certified.  Cross connection in potable water supply system.' THEN '03E'
                WHEN violations.violation_code = '06I' AND violations.violation_description = 'Food not labeled in accordance with HACCP plan.' THEN '06I'
                WHEN violations.violation_code = '06H' AND violations.violation_description = 'Records and logs not maintained to demonstrate that HACCP plan has been properly implemented.' THEN '06H'
                WHEN violations.violation_code = '16-09' AND violations.violation_description = 'Sodium Warning icon posted on menus, menu boards or food tags for food items that contain 2300mg or more of sodium is not a black and white equilateral triangle; or the  equilateral triangle is not as wide as it is tall, or is not equal in height to the largest letter in the food item' 's name, as displayed on the menu, menu board, or tag.' THEN '16-09'
                WHEN violations.violation_code = '04D' AND violations.violation_description = 'Food worker does not wash hands thoroughly after using the toilet, coughing, sneezing, smoking, eating, preparing raw foods or otherwise contaminating hands.' THEN '04D'
                WHEN violations.violation_code = '03F' AND violations.violation_description = 'Unpasteurized milk or milk product (except certain aged cheese) served.' THEN '03F'
                WHEN violations.violation_code = '02I' AND violations.violation_description = 'Food prepared from ingredients at ambient temperature not cooled to 41¬∫ F or below within 4 hours.' THEN '02I'
                WHEN violations.violation_code = '05C' AND violations.violation_description = 'Design, construction, materials used or maintenance of food contact surface improper.  Surface not easily cleanable, sanitized and maintained.  Culinary sink or other acceptable method not provided for washing food.' THEN '05C'
                WHEN violations.violation_code = '20-06' AND violations.violation_description = 'Current letter grade or "Grade Pending" card not posted.' THEN '20-06'
                WHEN violations.violation_code = '16-08' AND violations.violation_description = 'Sodium Warning icon not posted on menus, menu boards or food tags for food items that contain 2300mg or more of sodium in a food service establishment that is 1 of 15 or more outlets operating the same type of business nationally under common ownership or control, or as a franchise or doing business under the same name, for each menu item that is served in portions, the size and content of which are standardized' THEN '16-08'
                WHEN violations.violation_code = '05E' AND violations.violation_description = 'Insufficient or no refrigerated or hot holding equipment to keep potentially hazardous foods at required temperatures.' THEN '05E'
                WHEN violations.violation_code = '03D' AND violations.violation_description = 'Food package (including canned food product or hermetically sealed container) not in good condition to the degree contents are not suitable for human consumption. Package is swollen, leaking or rusted, without “DO NOT USE” label or not segregated from consumable food items.' THEN '03D'
                WHEN violations.violation_code = '18-13' AND violations.violation_description = 'Failure to comply with an order of the Board of Health, Commissioner or Department.' THEN '18-13'
                WHEN violations.violation_code = '16J' AND violations.violation_description = 'Sodium Warning - Icon not posted' THEN '16J'
                WHEN violations.violation_code = '16L' AND violations.violation_description = 'Sodium Warning - Statement' THEN '16L'
                WHEN violations.violation_code = '05C' AND violations.violation_description = 'Food contact surface, refillable, reusable containers, or equipment improperly constructed, placed or maintained. Unacceptable material used.  Culinary sink or other acceptable method not provided for washing food.' THEN '05C'
                WHEN violations.violation_code = '03C' AND violations.violation_description = 'Eggs found dirty/cracked; liquid, frozen or powdered eggs not pasteurized.' THEN '03C'
                WHEN violations.violation_code = '18-12' AND violations.violation_description = 'Document issued by the Board of Health, Commissioner or Department reproduced or altered. False, untrue or misleading statement or document made to, submitted or filed with the Department' THEN '18-12'
                WHEN violations.violation_code = '04I' AND violations.violation_description = 'Non-TCS food that has been served to the public being re-served. (Does not apply to wrapped foods where the wrapper seal has not been broken or opened).' THEN '04I'
                WHEN violations.violation_code = '06I' AND violations.violation_description = 'Food not labeled in accordance with the approved HACCP plan' THEN '06I'
                WHEN violations.violation_code = '06H' AND violations.violation_description = 'Records and logs not maintained to show that approved HACCP plan has been properly implemented.' THEN '06H'
                WHEN violations.violation_code = '02D' AND violations.violation_description = 'Precooked potentially hazardous food from commercial food processing establishment that is supposed to be heated, but is not heated to 140¬∫ F within 2 hours.' THEN '02D'
                WHEN violations.violation_code = '19-04' AND violations.violation_description = 'Expanded Polystyrene (EPS) single service article not designated as a recyclable material.' THEN '19-04'
                WHEN violations.violation_code = '03G' AND violations.violation_description = 'Raw fruit or vegetable not properly washed prior to cutting or serving.' THEN '03G'
                WHEN violations.violation_code = '16K' AND violations.violation_description = 'Sodium Warning - Icon not compliant' THEN '16K'
                WHEN violations.violation_code = '19-08' AND violations.violation_description = 'Failure to provide a single-use, non-compostable plastic straw upon request.' THEN '19-08'
                WHEN violations.violation_code = '19-01' AND violations.violation_description = 'Organics containers not provided' THEN '19-01'
                WHEN violations.violation_code = '19-03' AND violations.violation_description = 'Failure to post signage in organics collection area.' THEN '19-03'
                WHEN violations.violation_code = '04B' AND violations.violation_description = 'Food worker or vendor working or is knowingly or negligently permitted to work in FSE while afflicted with infected wound or reportable communicable disease. No spitting allowed. Spitting anywhere in the establishment is prohibited.' THEN '04B'
                WHEN violations.violation_code = '04B' AND violations.violation_description = 'Food worker or vendor working or is knowingly or negligently permitted to work in FSE while afflicted with  infected wound  or reportable communicable disease.  No spitting allowed. Spitting anywhere in the establishment is prohibited.' THEN '04B'
                WHEN violations.violation_code = '03G' AND violations.violation_description = 'Raw food not properly washed prior to serving.' THEN '03G'
                WHEN violations.violation_code = '18B' AND violations.violation_description = 'Document issued by the Board of Health, Commissioner or Department unlawfully reproduced or altered.' THEN '18B'
                WHEN violations.violation_code = '16A' AND violations.violation_description = 'A food containing artificial trans fat, with 0.5 grams or more of trans fat per serving, is being stored, distributed, held for service, used in preparation of a menu item, or served.' THEN '16A'
                WHEN violations.violation_code = '15-17' AND violations.violation_description = 'Sale of tobacco products, herbal cigarettes, liquid nicotine, shisha, rolling papers or smoking paraphernalia to minors prohibited' THEN '15-17'
                WHEN violations.violation_code = '15-39' AND violations.violation_description = 'Ashtray present in smoke-free area.' THEN '15-39'
                WHEN violations.violation_code = '15A1' AND violations.violation_description = 'No Smoking permitted in an area where it is prohibited' THEN '15A1'
                WHEN violations.violation_code = '28-07' AND violations.violation_description = 'Unapproved outdoor, street or sidewalk cooking.' THEN '28-07'
                WHEN violations.violation_code = '20-07' AND violations.violation_description = 'Letter grade or Grade Pending card removed, destroyed, modified, obscured, or otherwise tampered with' THEN '20-07'
                WHEN violations.violation_code = '15F2' AND violations.violation_description = 'Operator failed to make a good faith effort to inform smokers or users of electronic cigarettes of the SFAA' THEN '15F2'
                WHEN violations.violation_code = '03D' AND violations.violation_description = 'Food package (including canned food product or hermetically sealed container) not in good condition to the degree contents are not suitable for human consumption. Package is swollen, leaking or rusted, without “DO NOT USE” label or not segregated from consumable food items.' THEN '03D'
                WHEN violations.violation_code = '18D' AND violations.violation_description = 'Failure to comply with an Order of the Board of Health, Commissioner, or Department.' THEN '18D'
                WHEN violations.violation_code = '03D' AND violations.violation_description = 'Canned food product observed swollen, leaking or rusted, and not segregated from other consumable food items.' THEN '03D'
                WHEN violations.violation_code = '15-33' AND violations.violation_description = 'Warning sign re dangers of hookah smoking not posted in each room or area of Non-Tobacco Hookah Establishment (NTHE) where smoking is allowed' THEN '15-33'
                WHEN violations.violation_code = '15000' AND violations.violation_description = 'Original label for smoking products sold or offered for sale' THEN '15000'
                WHEN violations.violation_code = '15-36' AND violations.violation_description = 'Sign prohibiting entry of persons under 21 years of age not posted at public entryway to Non-Tobacco Hookah Establishment (NTHE)' THEN '15-36'
                WHEN violations.violation_code = '20C' AND violations.violation_description = 'Food allergy poster does not contain text provided or approved by Department.' THEN '20C'
                WHEN violations.violation_code = '10G' AND violations.violation_description = 'Food service operation occurring in room used as living or sleeping quarters.' THEN '10G'
                WHEN violations.violation_code = '18-02' AND violations.violation_description = 'Current valid permit, registration or other authorization to operate a Temporary Food Service Establishment (TFSE) not available.' THEN '18-02'
                ELSE 'N/A'
                END = `cis9440gp.dbt_lsousa.violation_dim`.violation_code
    RIGHT JOIN `cis9440gp.dbt_qlin.location_dimension` 
            ON CASE
                WHEN violations.community_board ='164' THEN '100'
                WHEN violations.community_board like '22%' THEN '200'
                WHEN violations.community_board like '355' THEN '300'
                WHEN violations.community_board like '48%' THEN '400'
                WHEN violations.community_board='595' THEN '500'
                WHEN violations.boro ='Manhattan' AND violations.community_board IS NULL THEN '100'
                WHEN violations.boro ='Bronx' AND violations.community_board IS NULL THEN '200'
                WHEN violations.boro ='Brooklyn' AND violations.community_board IS NULL THEN '300'
                WHEN violations.boro ='Queens' AND violations.community_board IS NULL THEN '400'
                WHEN violations.boro ='Staten Island' AND violations.community_board IS NULL THEN '500'
                ELSE violations.community_board 
                END = `cis9440gp.dbt_qlin.location_dimension`.community_board AND
            COALESCE(violations.zipcode,'99999') = `cis9440gp.dbt_qlin.location_dimension`.zipcode AND
            COALESCE(violations.street,'Unspecified') = `cis9440gp.dbt_qlin.location_dimension`.street_address
            AND UPPER(violations.boro) = `cis9440gp.dbt_qlin.location_dimension`.city_borough
            AND violations.street=`cis9440gp.dbt_qlin.location_dimension`.street_address
            AND violations.zipcode = `cis9440gp.dbt_qlin.location_dimension`.zipcode 
            AND violations.community_board = `cis9440gp.dbt_qlin.location_dimension`.community_board
    RIGHT JOIN `cis9440gp.dbt_lsousa.business_dim`
    ON `cis9440gp.dbt_lsousa.business_dim`.business_name = violations.dba
        AND `cis9440gp.dbt_lsousa.business_dim`.cuisine_description = violations.cuisine_description 
        AND `cis9440gp.dbt_lsousa.business_dim`.incident_address = CONCAT(violations.building,' ', violations.street))
            SELECT ROW_NUMBER() OVER() AS unique_violation_id, * FROM violation_facts_table